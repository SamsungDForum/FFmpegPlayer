<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1189px" preserveAspectRatio="none" style="width:953px;height:1189px;" version="1.1" viewBox="0 0 953 1189" width="953px" zoomAndPan="magnify"><defs><filter height="300%" id="f1o87285a76up2" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="258.8125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="781" y="69.2188"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="81.7031" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="781" y="879.6016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="781" x2="781" y1="879.6016" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="791" x2="791" y1="879.6016" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="781" x2="791" y1="879.6016" y2="879.6016"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="153.7578" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="781" y="989.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="781" x2="781" y1="989.3047" y2="1143.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="791" x2="791" y1="989.3047" y2="1143.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="781" x2="791" y1="1143.0625" y2="1143.0625"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="32.3516" style="stroke: #000000; stroke-width: 2.0;" width="378" x="3" y="167.2734"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="857.5" x="72" y="256.9766"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="260.8125" style="stroke: #000000; stroke-width: 2.0;" width="887.5" x="52" y="479.0859"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="124.4063" style="stroke: #000000; stroke-width: 2.0;" width="867.5" x="62" y="608.4922"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="61.7031" style="stroke: #000000; stroke-width: 2.0;" width="291" x="72" y="664.1953"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="154.7578" style="stroke: #000000; stroke-width: 2.0;" width="857.5" x="72" y="996.3047"/><rect fill="#FFFFFF" height="62.7031" style="stroke: none; stroke-width: 1.0;" width="857.5" x="72" y="1088.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="158" y1="59.2188" y2="815.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="158" x2="158" y1="815.25" y2="843.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="158" y1="843.25" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="158" x2="158" y1="961.3047" y2="989.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="158" y1="989.3047" y2="1182.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="544.5" x2="544.5" y1="59.2188" y2="815.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="544.5" x2="544.5" y1="815.25" y2="843.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="544.5" x2="544.5" y1="843.25" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="544.5" x2="544.5" y1="961.3047" y2="989.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="544.5" x2="544.5" y1="989.3047" y2="1182.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666.5" x2="666.5" y1="59.2188" y2="815.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="666.5" x2="666.5" y1="815.25" y2="843.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666.5" x2="666.5" y1="843.25" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="666.5" x2="666.5" y1="961.3047" y2="989.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666.5" x2="666.5" y1="989.3047" y2="1182.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="785.5" x2="785.5" y1="59.2188" y2="815.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="785.5" x2="785.5" y1="815.25" y2="843.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="785.5" x2="785.5" y1="843.25" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="785.5" x2="785.5" y1="961.3047" y2="989.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="785.5" x2="785.5" y1="989.3047" y2="1182.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881.5" x2="881.5" y1="59.2188" y2="815.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="881.5" x2="881.5" y1="815.25" y2="843.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881.5" x2="881.5" y1="843.25" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="881.5" x2="881.5" y1="961.3047" y2="989.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881.5" x2="881.5" y1="989.3047" y2="1182.0625"/><rect fill="#FEFECE" filter="url(#f1o87285a76up2)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="82" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="134" x="89" y="26.5332">«EsPlayerPresenter»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="110" y="44.1426">DataPresenter</text><rect fill="#FEFECE" filter="url(#f1o87285a76up2)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="494.5" y="22.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="501.5" y="44.1426">DataProvider</text><rect fill="#FEFECE" filter="url(#f1o87285a76up2)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="605.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="93" x="618.5" y="26.5332">«DataReader»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="612.5" y="44.1426">FactoryDelegate</text><rect fill="#FEFECE" filter="url(#f1o87285a76up2)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="738.5" y="22.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="745.5" y="44.1426">DataReader</text><rect fill="#FEFECE" filter="url(#f1o87285a76up2)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="843.5" y="22.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="850.5" y="44.1426">ESPlayer</text><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="258.8125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="781" y="69.2188"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="81.7031" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="781" y="879.6016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="781" x2="781" y1="879.6016" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="791" x2="791" y1="879.6016" y2="961.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="781" x2="791" y1="879.6016" y2="879.6016"/><rect fill="#FFFFFF" filter="url(#f1o87285a76up2)" height="153.7578" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="781" y="989.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="781" x2="781" y1="989.3047" y2="1143.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="791" x2="791" y1="989.3047" y2="1143.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="781" x2="791" y1="1143.0625" y2="1143.0625"/><polygon fill="#A80036" points="146,87.5703,156,91.5703,146,95.5703,150,91.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="0" x2="152" y1="91.5703" y2="91.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="7" y="86.7139">Seek( SeekDirection )</text><polygon fill="#A80036" points="533,117.9219,543,121.9219,533,125.9219,537,121.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="539" y1="121.9219" y2="121.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="165" y="117.0654">streamDuration = CurrentConfiguration.Duration</text><polygon fill="#A80036" points="169,148.2734,159,152.2734,169,156.2734,165,152.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="163" x2="544" y1="152.2734" y2="152.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="175" y="147.417">TimeSpan</text><path d="M3,167.2734 L63,167.2734 L63,175.2734 L53,185.2734 L3,185.2734 L3,167.2734 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="32.3516" style="stroke: #000000; stroke-width: 2.0;" width="378" x="3" y="167.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="18" y="181.7686">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="298" x="78" y="180.6924">[streamDuration == TimeSpan.Zero Stream not seekable]</text><polygon fill="#A80036" points="11,187.625,1,191.625,11,195.625,7,191.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="5" x2="157" y1="191.625" y2="191.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="200" y1="228.9766" y2="228.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="200" y1="228.9766" y2="241.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159" x2="200" y1="241.9766" y2="241.9766"/><polygon fill="#A80036" points="169,237.9766,159,241.9766,169,245.9766,165,241.9766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="165" y="224.1201">resumeAfterSeek = _dataReaderSession != null</text><path d="M72,256.9766 L132,256.9766 L132,264.9766 L122,274.9766 L72,274.9766 L72,256.9766 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="857.5" x="72" y="256.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="87" y="271.4717">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="231" x="147" y="270.3955">[resumeAfterSeek == true Currently playing]</text><polygon fill="#A80036" points="869.5,293.6797,879.5,297.6797,869.5,301.6797,873.5,297.6797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="875.5" y1="297.6797" y2="297.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="165" y="292.8232">Pause()</text><polygon fill="#A80036" points="774,324.0313,784,328.0313,774,332.0313,778,328.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="780" y1="328.0313" y2="328.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="165" y="323.1748">await DisposeAsync()</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="777" x2="795" y1="319.0313" y2="337.0313"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="777" x2="795" y1="337.0313" y2="319.0313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="200" y1="365.3828" y2="365.3828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="200" y1="365.3828" y2="378.3828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159" x2="200" y1="378.3828" y2="378.3828"/><polygon fill="#A80036" points="169,374.3828,159,378.3828,169,382.3828,165,378.3828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="165" y="360.5264">position = SeekNextPosition(direction, streamDuration)</text><polygon fill="#A80036" points="533,404.7344,543,408.7344,533,412.7344,537,408.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="539" y1="408.7344" y2="408.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="165" y="403.8779">seekDataTask = Seek( position )</text><polygon fill="#A80036" points="169,435.0859,159,439.0859,169,443.0859,165,439.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="163" x2="544" y1="439.0859" y2="439.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="175" y="434.2295">Task</text><path d="M52,479.0859 L612,479.0859 L612,487.0859 L602,497.0859 L52,497.0859 L52,479.0859 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="260.8125" style="stroke: #000000; stroke-width: 2.0;" width="887.5" x="52" y="479.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="515" x="67" y="493.5811">(readyToTransferTask, seekAsyncTask)  = SeekESplayer( ESPlayer, TimeSpan, int )</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="200" y1="519.7891" y2="519.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="200" y1="519.7891" y2="532.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159" x2="200" y1="532.7891" y2="532.7891"/><polygon fill="#A80036" points="169,528.7891,159,532.7891,169,536.7891,165,532.7891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="165" y="514.9326">readyToTransferTcs = new TaskCompletionSource()</text><polygon fill="#A80036" points="869.5,559.1406,879.5,563.1406,869.5,567.1406,873.5,563.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="875.5" y1="563.1406" y2="563.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="165" y="558.2842">seekAsyncTask = SeekAsync( position )</text><polygon fill="#A80036" points="169,589.4922,159,593.4922,169,597.4922,165,593.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="163" x2="880.5" y1="593.4922" y2="593.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="175" y="588.6357">Task</text><path d="M62,608.4922 L127,608.4922 L127,616.4922 L117,626.4922 L62,626.4922 L62,608.4922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="124.4063" style="stroke: #000000; stroke-width: 2.0;" width="867.5" x="62" y="608.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="77" y="622.9873">par</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="399" x="142" y="621.9111">[Parallel with await Task.WhenAll(readyToTransferTcs.Task, seekDataTask)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="168" y1="649.1953" y2="645.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="168" y1="649.1953" y2="653.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="880.5" y1="649.1953" y2="649.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="175" y="644.3389">onReadyToSeek( StreamType, TimeSpan )</text><path d="M72,664.1953 L132,664.1953 L132,672.1953 L122,682.1953 L72,682.1953 L72,664.1953 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="61.7031" style="stroke: #000000; stroke-width: 2.0;" width="291" x="72" y="664.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="87" y="678.6904">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="147" y="677.6143">[All streams reported onReadyToSeek]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="200" y1="704.8984" y2="704.8984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="200" y1="704.8984" y2="717.8984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159" x2="200" y1="717.8984" y2="717.8984"/><polygon fill="#A80036" points="169,713.8984,159,717.8984,169,721.8984,165,717.8984" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="165" y="700.042">readyToTransferTcs.SetResult()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="200" y1="794.25" y2="794.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="200" y1="794.25" y2="807.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159" x2="200" y1="807.25" y2="807.25"/><polygon fill="#A80036" points="169,803.25,159,807.25,169,811.25,165,807.25" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="165" y="789.3936">await Task.WhenAll( readyToTransferTcs.Task, seekDataTask )</text><polygon fill="#A80036" points="655,861.6016,665,865.6016,655,869.6016,659,865.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="661" y1="865.6016" y2="865.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="165" y="860.7451">session = FactoryDelegate()</text><polygon fill="#A80036" points="769,875.6016,779,879.6016,769,883.6016,773,879.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="667" x2="775" y1="879.6016" y2="879.6016"/><polygon fill="#A80036" points="169,905.9531,159,909.9531,169,913.9531,165,909.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="163" x2="666" y1="909.9531" y2="909.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="175" y="905.0967">DataReader</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="200" y1="940.3047" y2="940.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="200" y1="940.3047" y2="953.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159" x2="200" y1="953.3047" y2="953.3047"/><polygon fill="#A80036" points="169,949.3047,159,953.3047,169,957.3047,165,953.3047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="165" y="935.4482">await seekAsyncTask</text><path d="M72,996.3047 L132,996.3047 L132,1004.3047 L122,1014.3047 L72,1014.3047 L72,996.3047 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="154.7578" style="stroke: #000000; stroke-width: 2.0;" width="857.5" x="72" y="996.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="87" y="1010.7998">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="147" y="1009.7236">[resumeAfterSeek == true]</text><polygon fill="#A80036" points="869.5,1033.0078,879.5,1037.0078,869.5,1041.0078,873.5,1037.0078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="875.5" y1="1037.0078" y2="1037.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="165" y="1032.1514">Resume()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="200" y1="1067.3594" y2="1067.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="200" x2="200" y1="1067.3594" y2="1080.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159" x2="200" y1="1080.3594" y2="1080.3594"/><polygon fill="#A80036" points="169,1076.3594,159,1080.3594,169,1084.3594,165,1080.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="165" y="1062.5029">_readingSession = session</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="72" x2="929.5" y1="1089.3594" y2="1089.3594"/><polygon fill="#A80036" points="869.5,1108.7109,879.5,1112.7109,869.5,1116.7109,873.5,1112.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="875.5" y1="1112.7109" y2="1112.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="165" y="1107.8545">Pause()</text><polygon fill="#A80036" points="774,1139.0625,784,1143.0625,774,1147.0625,778,1143.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="780" y1="1143.0625" y2="1143.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="165" y="1138.2061">session.Dispose()</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="777" x2="795" y1="1134.0625" y2="1152.0625"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="777" x2="795" y1="1152.0625" y2="1134.0625"/><polygon fill="#A80036" points="11,1160.0625,1,1164.0625,11,1168.0625,7,1164.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="5" x2="157" y1="1164.0625" y2="1164.0625"/><!--MD5=[9ae6dc187b02ebe6eb932b0d1f438e09]
@startuml EsPlayerPresenterSeek
hide footbox

participant DataPresenter <<EsPlayerPresenter>>
participant DataProvider
participant FactoryDelegate <<DataReader>>
participant DataReader
participant ESPlayer

activate DataReader

[-> DataPresenter : Seek( SeekDirection )
DataPresenter -> DataProvider : streamDuration = CurrentConfiguration.Duration
DataPresenter <- - DataProvider : TimeSpan
alt streamDuration == TimeSpan.Zero Stream not seekable
[<- - DataPresenter
end

DataPresenter -> DataPresenter : resumeAfterSeek = _dataReaderSession != null
alt resumeAfterSeek == true Currently playing
    DataPresenter -> ESPlayer : Pause()
    DataPresenter -> DataReader : await DisposeAsync()
    destroy DataReader
end

DataPresenter -> DataPresenter : position = SeekNextPosition(direction, streamDuration)
DataPresenter -> DataProvider : seekDataTask = Seek( position )
DataPresenter <- - DataProvider : Task

|||
group (readyToTransferTask, seekAsyncTask)  = SeekESplayer( ESPlayer, TimeSpan, int )
    DataPresenter -> DataPresenter : readyToTransferTcs = new TaskCompletionSource()
    DataPresenter -> ESPlayer : seekAsyncTask = SeekAsync( position )
    DataPresenter <- - ESPlayer : Task
    
    par Parallel with await Task.WhenAll(readyToTransferTcs.Task, seekDataTask)
        DataPresenter <<- ESPlayer : onReadyToSeek( StreamType, TimeSpan )

        alt All streams reported onReadyToSeek
            DataPresenter <- DataPresenter : readyToTransferTcs.SetResult()
        end
    end
end
|||
DataPresenter -> DataPresenter : await Task.WhenAll( readyToTransferTcs.Task, seekDataTask )
...
DataPresenter -> FactoryDelegate : session = FactoryDelegate()
FactoryDelegate -> DataReader
activate DataReader
DataPresenter <- - FactoryDelegate : DataReader

DataPresenter -> DataPresenter : await seekAsyncTask
...

alt resumeAfterSeek == true
    DataPresenter -> ESPlayer : Resume()
    DataPresenter -> DataPresenter : _readingSession = session
else
    DataPresenter -> ESPlayer : Pause()
    DataPresenter -> DataReader : session.Dispose()
    destroy DataReader
end

[<- - DataPresenter
@enduml

PlantUML version 1.2020.20(Sat Nov 21 11:02:45 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1250
Language: en
Country: GB
--></g></svg>